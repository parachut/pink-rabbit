# Migration `20200424135916`

This migration has been generated by Daniel Wallace at 4/24/2020, 1:59:16 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Address" ADD COLUMN "deleted" boolean   ;

ALTER TABLE "public"."AddressHistory" DROP CONSTRAINT IF EXiSTS "AddressHistory_addressId_fkey",
ALTER COLUMN "action" SET DEFAULT 'CREATED',
ALTER COLUMN "addressId" DROP NOT NULL;

ALTER TABLE "public"."Inventory" ALTER COLUMN "condition" SET DEFAULT 'NEW',
ALTER COLUMN "status" SET DEFAULT 'NEW';

ALTER TABLE "public"."Order" ADD COLUMN "addressId" text   ;

ALTER TABLE "public"."Shipment" ALTER COLUMN "direction" SET DEFAULT 'OUTBOUND',
ALTER COLUMN "status" SET DEFAULT 'PRETRANSIT',
ALTER COLUMN "type" SET DEFAULT 'ACCESS';

ALTER TABLE "public"."Warehouse" DROP COLUMN "carrierFacility",
DROP COLUMN "city",
DROP COLUMN "country",
DROP COLUMN "email",
DROP COLUMN "phone",
DROP COLUMN "residential",
DROP COLUMN "state",
DROP COLUMN "street1",
DROP COLUMN "street2",
DROP COLUMN "zip",
ADD COLUMN "addressId" text   ;

ALTER TABLE "public"."exif_spec_value" DROP CONSTRAINT IF EXiSTS "exif_spec_value_picture_id_fkey";

ALTER TABLE "public"."exif_spec_value" DROP CONSTRAINT IF EXiSTS "exif_spec_value_spec_name_id_fkey";

ALTER TABLE "public"."AddressHistory" ADD FOREIGN KEY ("addressId")REFERENCES "public"."Address"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Order" ADD FOREIGN KEY ("addressId")REFERENCES "public"."Address"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Warehouse" ADD FOREIGN KEY ("addressId")REFERENCES "public"."Address"("id") ON DELETE SET NULL  ON UPDATE CASCADE

DROP TABLE "public"."exif_spec_value";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200423111331-remove-maps..20200424135916
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator client {
   provider = "prisma-client-js"
@@ -145,37 +145,32 @@
   name        String
   company     String?
   phone       String?
   email       String
+  deleted     Boolean?
   userId      String
   shipments   Shipment[]
+  warehouses  Warehouse[]
+  orders      Order[]
   history     AddressHistory[]
 }
 model AddressHistory {
   time      DateTime       @default(now())
   action    DatabaseAction @default(CREATED)
   userId    String
-  addressId String
-  address   Address        @relation(fields: [addressId], references: [id])
+  addressId String?
+  address   Address?       @relation(fields: [addressId], references: [id])
   id        Int            @default(autoincrement()) @id
 }
 model Warehouse {
-  id              String   @default(uuid()) @id
-  street1         String
-  street2         String?
-  city            String
-  state           String
-  zip             String
-  country         String
-  residential     Boolean
-  carrierFacility String
-  name            String
-  phone           String
-  email           String
-  created         DateTime @default(now())
-  shippoId        String
+  id        String   @default(uuid()) @id
+  name      String
+  created   DateTime @default(now())
+  shippoId  String
+  address   Address? @relation(fields: [addressId], references: [id])
+  addressId String?
 }
 enum ShipmentDirection {
   INBOUND
@@ -245,8 +240,10 @@
   plan      String?
   expedited Boolean     @default(false)
   userId    String
   items     OrderItem[]
+  address   Address?    @relation(fields: [addressId], references: [id])
+  addressId String?
 }
 model OrderItem {
   id        String   @default(uuid()) @id
```


